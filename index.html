<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Trader Agent — Subscription Gate</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#0b1327; color:#e5e7eb; }
    .btn { padding:10px 16px; border-radius:8px; border:1px solid #6366f1; background:transparent; color:#fff; cursor:pointer; font-weight:600; }
    .btn:hover { background:#6366f1; }
    .card { background:#111827; border:1px solid #374151; padding:16px; border-radius:12px; margin:12px auto; max-width:400px; }
    #trialGateBackdrop {
      position:fixed; inset:0; background:rgba(0,0,0,0.8); display:none; z-index:9998;
    }
    #trialGate {
      position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
      background:#111827; border:1px solid #374151; border-radius:12px;
      padding:24px; width:90%; max-width:420px; display:none; z-index:9999;
    }
    body.trial-show #trialGateBackdrop,
    body.trial-show #trialGate { display:block; }
    input { padding:8px; border-radius:6px; border:1px solid #374151; background:#1f2937; color:#fff; width:100%; }
  </style>
</head>
<body>
  <div id="app">
    <h1 style="text-align:center; padding:20px 0;">Добро пожаловать в AI Trader Agent</h1>
    <p style="text-align:center;">Приложение работает в демо-режиме 5 минут. Потом нужно зарегистрироваться.</p>
  </div>

  <!-- Gate -->
  <div id="trialGateBackdrop"></div>
  <div id="trialGate">
    <h2 style="margin-top:0">ПРОЙТИ РЕГИСТРАЦИЮ</h2>
    <div class="card">
      <h3>Оплата подписки 5 USDT (BSC)</h3>
      <p>Сеть: <b>BSC (BEP20)</b></p>
      <div style="margin:8px 0">
        <div>Адрес кошелька:</div>
        <code id="gateAddr">0xD2471faD1f058fD01591364651619Bb6D59d5405</code>
        <button id="gateCopy" class="btn">Скопировать</button>
      </div>
      <input id="gateTx" placeholder="TxID / Hash">
      <button id="gatePaid" class="btn" style="margin-top:8px">Я оплатил(а)</button>
    </div>
    <div class="card">
      <h3>Регистрация</h3>
      <input id="gateEmail" type="email" placeholder="Ваш e-mail">
      <input id="gatePass" type="password" placeholder="Пароль" disabled style="margin-top:8px">
      <button id="gateFinish" class="btn" disabled style="margin-top:8px">Завершить регистрацию</button>
    </div>
  </div>

  <!-- Gate script (5 min strict) -->
  <script>
  (function(){
    const MINUTES = 5;
    const START_KEY = 'crt_trial_session_start';
    const PAID = 'crt_sub_active';
    const REG  = 'crt_user_registered';
    let start = Number(sessionStorage.getItem(START_KEY));
    if (!Number.isFinite(start) || start<=0){ start = Date.now(); sessionStorage.setItem(START_KEY,String(start)); }
    const fireAt = start + MINUTES*60*1000;

    function isPaid(){ return localStorage.getItem(PAID)==='1'; }
    function isReg(){ return localStorage.getItem(REG)==='1'; }
    function showGate(){
      if (isPaid()&&isReg()) return;
      document.body.classList.add('trial-show','trial-locked');
    }
    function maybeClose(){
      if (isPaid()&&isReg()){ document.body.classList.remove('trial-show','trial-locked'); }
    }
    const ms = Math.max(0, fireAt - Date.now());
    if (ms===0) showGate(); else setTimeout(showGate, ms);
    setInterval(()=>{ if (isPaid()&&isReg()) maybeClose(); else if (Date.now()>=fireAt) showGate(); }, 4000);

    const addr=document.getElementById('gateAddr');
    const copy=document.getElementById('gateCopy');
    const tx=document.getElementById('gateTx');
    const paid=document.getElementById('gatePaid');
    const email=document.getElementById('gateEmail');
    const pass=document.getElementById('gatePass');
    const finish=document.getElementById('gateFinish');

    copy.onclick=async()=>{ try{ await navigator.clipboard.writeText(addr.textContent); copy.textContent='Скопировано'; setTimeout(()=>copy.textContent='Скопировать',1200);}catch{} };
    paid.onclick=()=>{ if(!tx.value.trim()){ alert('Введите TxID'); return;} localStorage.setItem(PAID,'1'); pass.disabled=false; finish.disabled=false; };
    finish.onclick=()=>{ if(!email.value.trim()||!pass.value.trim()){ alert('Заполните e-mail и пароль'); return;} localStorage.setItem(REG,'1'); maybeClose(); alert('Регистрация завершена.'); };
  })();
  </script>

  <!-- Whitelist email: smarttfon@gmail.com -->
  <script>
    const CRT_WHITELIST = ["smarttfon@gmail.com"];
    function crtIsWhitelisted(email){ return CRT_WHITELIST.includes(String(email||'').trim().toLowerCase()); }
    function crtBypassFor(email){
      if(!crtIsWhitelisted(email)) return false;
      localStorage.setItem('crt_sub_active','1');
      localStorage.setItem('crt_user_registered','1');
      document.body.classList.remove('trial-show','trial-locked');
      alert('Аккаунт smarttfon@gmail.com активирован без оплаты.');
      return true;
    }
    (function(){
      const email=document.getElementById('gateEmail');
      const pass=document.getElementById('gatePass');
      const finish=document.getElementById('gateFinish');
      if(email&&finish){
        email.addEventListener('input',()=>{ if(crtIsWhitelisted(email.value)){ pass.disabled=false; finish.disabled=false; } });
        finish.addEventListener('click',(e)=>{ if(crtIsWhitelisted(email.value)){ e.preventDefault(); crtBypassFor(email.value); } });
      }
    })();
  </script>
</body>
</html>
